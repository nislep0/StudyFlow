# Лабораторна робота №5

## Тема

Тестування серверної частини вебзастосунку (unit, integration та e2e тести).

## Мета роботи

Ознайомитися з підходами до тестування backend-застосунків на Node.js. Навчитися писати unit-тести, інтеграційні тести та end-to-end (E2E) тести для REST API з використанням реальної бази даних.

## Використані технології

- Node.js
- Express
- PostgreSQL
- Prisma ORM
- Vitest
- Supertest
- Docker

## Опис виконання роботи

### Unit-тести

Для unit-тестування була використана бібліотека **Vitest**. Unit-тести покривають логіку валідації даних (файл `validation.test.ts`). У тестах перевіряється коректна обробка валідних та невалідних даних без взаємодії з базою даних.

### Інтеграційні тести

Інтеграційні тести перевіряють роботу HTTP API разом з реальною базою даних PostgreSQL.

Для цього:

- Піднімається окрема тестова база даних PostgreSQL за допомогою Docker (`docker-compose.test.yml`).
- Перед запуском тестів схема бази даних ініціалізується через Prisma командою `prisma db push`.
- Тести виконуються через `supertest`, використовуючи `createApp()` без моків.

Інтеграційні тести перевіряють:

- доступність health endpoint;
- створення та отримання курсів;
- створення, оновлення та фільтрацію завдань;
- каскадне видалення повʼязаних записів.

### End-to-End (E2E) тести

E2E тести перевіряють повний сценарій роботи застосунку:

- запускається реальний HTTP сервер;
- виконується підключення до реальної PostgreSQL бази даних;
- тести надсилають HTTP-запити як реальний клієнт (через `fetch`).

E2E тести перевіряють повний життєвий цикл роботи з API: створення курсів, створення та оновлення завдань, а також перевірку каскадного видалення.

## Команди для запуску тестів

### Для запуску необхідно створити .env на основі .env.example

### Інтеграційні тести

```bash
docker compose -f docker-compose.test.yml up -d
npm run test:integration:dbpush
npm run test:integration:run
```

### E2E тести

```bash
docker compose -f docker-compose.test.yml up -d
npm run test:e2e:dbpush
npm run test:e2e:run
```

Або запуск всіх тестів:

```bash
docker compose -f docker-compose.test.yml up -d
npm run test:all
```

Після завершення тестів база даних зупиняється:

```bash
docker compose -f docker-compose.test.yml down -v
```

## Висновки

Під час виконання лабораторної роботи було реалізовано різні рівні тестування серверної частини застосунку. Unit-тести дозволяють перевіряти окрему бізнес-логіку, інтеграційні тести - взаємодію API з базою даних, а E2E тести - повний сценарій роботи системи. Використання Docker та Prisma значно спростило налаштування тестового середовища та зробило тести стабільними та повторюваними.
